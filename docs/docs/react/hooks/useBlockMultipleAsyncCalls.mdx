import { useState } from 'react';
import { useBlockMultipleAsyncCalls } from '@modern-kit/react';

# useBlockMultipleAsyncCalls

ì§„í–‰ ì¤‘ì¸ ë¹„ë™ê¸° í˜¸ì¶œì´ ìˆì„ ë•Œ ì¤‘ë³µ í˜¸ì¶œì„ ë°©ì§€í•˜ë©°, `isLoading`ê³¼ `isError` ìƒíƒœë¥¼ í•¨ê»˜ ì œê³µí•˜ëŠ” ì»¤ìŠ¤í…€ í›…ì…ë‹ˆë‹¤.

`debounce/throttle`ëŠ” í•¨ìˆ˜ì˜ ì¤‘ë³µ í˜¸ì¶œì„ ë°©ì§€í•˜ëŠ” ë° ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì— íš¨ê³¼ì ì…ë‹ˆë‹¤.
í•˜ì§€ë§Œ, `debounce/throttle`ëŠ” ë¹„ë™ê¸° ì‘ì—…ì˜ ì™„ë£Œë¥¼ ë³´ì¥í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì€ í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤:

1. `debounce/throttle` ì‹œê°„ì´ API ì‘ë‹µ ì‹œê°„ë³´ë‹¤ ì§§ì„ ê²½ìš°: ë¹„ë™ê¸° ì‘ì—…ì´ ì™„ë£Œë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ `ë‹¤ì‹œ í˜¸ì¶œ`ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. `debounce/throttle` ì‹œê°„ì´ API ì‘ë‹µ ì‹œê°„ë³´ë‹¤ ê¸¸ ê²½ìš°: ë¹„ë™ê¸° ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆì§€ë§Œ `ë²„íŠ¼`ê³¼ ê°™ì€ ìš”ì†Œê°€ ì—¬ì „íˆ `ë¹„í™œì„±í™”`ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. `ì¦‰ê°ì ì¸ ë°˜ì‘`ì„ ì›í•˜ëŠ” ê²½ìš°: `debounce/throttle`ëŠ” í˜¸ì¶œì„ ì§€ì—°ì‹œí‚¤ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìì—ê²Œ `ì¦‰ê°ì ì¸ ë°˜ì‘`ì„ ë³´ì—¬ì£¼ê¸°ì— ì œí•œì ì…ë‹ˆë‹¤.
4. `debounce/throttle`ì€ `ì‹œê°„`ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— `ì–¼ë§ˆë‚˜ ìì£¼ ì‹¤í–‰`ë˜ëŠ”ì§€ê°€ ì¤‘ìš”í•˜ì§€ `ì¤‘ë³µ í˜¸ì¶œ ì—¬ë¶€`ë¥¼ íŒŒì•…í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.

ìœ„ì™€ ê°™ì€ í•œê³„ì ì„ ëŒ€ì‘í•˜ê³ ì í•œë‹¤ë©´ `useBlockMultipleAsyncCalls`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />

## Code
[ğŸ”— ì‹¤ì œ êµ¬í˜„ ì½”ë“œ í™•ì¸](https://github.com/modern-agile-team/modern-kit/blob/main/packages/react/src/hooks/useBlockMultipleAsyncCalls/index.ts)

<br />

## Interface
```ts title="typescript"
interface UseBlockMultipleAsyncCallsReturnType {
  isError: boolean;
  isLoading: boolean;
  blockMultipleAsyncCalls: <T, Args extends unknown[]>(
    callback: (...args: Args) => Promise<T>
  ) => (...args: Args) => Promise<T | undefined>;
}
```
```ts title="typescript"
function useBlockMultipleAsyncCalls(): UseBlockMultipleAsyncCallsReturnType
```

<br />

## Usage

### ê¸°ë³¸ ì‚¬ìš©ë²•

`blockMultipleAsyncCalls(callback)`ì€ ë˜í•‘ëœ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ë°˜í™˜ëœ í•¨ìˆ˜ë¥¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¡œ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx title="typescript"
import { useBlockMultipleAsyncCalls } from '@modern-kit/react';

const Component = () => {
  const { isLoading, isError, blockMultipleAsyncCalls } = useBlockMultipleAsyncCalls();

  const fetchData = async () => {
    const data = await fetch('/api/data').then((res) => res.json());
    // ë°ì´í„° ì²˜ë¦¬
  };

  const handleClick = blockMultipleAsyncCalls(fetchData);

  return (
    <div>
      <button onClick={handleClick} disabled={isLoading}>
        {isLoading ? 'ë¡œë”© ì¤‘...' : 'ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°'}
      </button>
      {isError && <p>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>}
    </div>
  );
};
```

<br />

### ì¸ì ì „ë‹¬

ì½œë°± í•¨ìˆ˜ì— ì¸ìë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx title="typescript"
import { useBlockMultipleAsyncCalls } from '@modern-kit/react';

const Component = () => {
  const { isLoading, blockMultipleAsyncCalls } = useBlockMultipleAsyncCalls();

  const fetchUser = async (userId: number) => {
    const user = await fetch(`/api/users/${userId}`).then((res) => res.json());
    // ì‚¬ìš©ì ì •ë³´ ì²˜ë¦¬
  };

  return (
    <button onClick={() => blockMultipleAsyncCalls(fetchUser)(42)} disabled={isLoading}>
      ì‚¬ìš©ì ë¶ˆëŸ¬ì˜¤ê¸°
    </button>
  );
};
```

<br />

### @tanstack/react-queryì™€ í•¨ê»˜ ì‚¬ìš©í•˜ê¸°
```tsx title="typescript"
import { useBlockMultipleAsyncCalls } from '@modern-kit/react';
import { useQuery } from '@tanstack/react-query';

const Component = () => {
  const { blockMultipleAsyncCalls } = useBlockMultipleAsyncCalls();

  const fetchUser = async ({ id }: { id: number }) => {
    const user = await fetch(`/api/users/${id}`).then((res) => res.json());
    return user;
  };

  const mutation = useMutation({
    mutationFn: blockMultipleAsyncCalls(fetchUser),
  });

  return <button onClick={() => mutation.mutate({ id: 42 })}>ì‚¬ìš©ì ë¶ˆëŸ¬ì˜¤ê¸°</button>;
};
```

<br />

## Example

### Example1 (ê¸°ë³¸ ì‚¬ìš© ì˜ˆì œ)

ë²„íŠ¼ì„ ë¹ ë¥´ê²Œ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•´ë³´ì„¸ìš”. `isLoading`ì´ `true`ì¸ ë™ì•ˆì—ëŠ” ì¤‘ë³µ ìš”ì²­ì´ ì°¨ë‹¨ë˜ë©°, ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.

export const Example1 = () => {
  const [fetchCount, setFetchCount] = useState(0);
  const [clickCount, setClickCount] = useState(0);
  const [lastResult, setLastResult] = useState(null);
  const { isLoading, isError, blockMultipleAsyncCalls } = useBlockMultipleAsyncCalls();

  const fetchTodo = async (id) => {
    const res = await fetch(`https://jsonplaceholder.typicode.com/todos/${id}`).then((r) => r.json());
    setLastResult(res.title);
    setFetchCount((c) => c + 1);
    return res;
  };

  const handleClick = blockMultipleAsyncCalls(fetchTodo);

  return (
    <div style={{ fontFamily: 'sans-serif' }}>
      <p style={{ fontSize: '14px', color: '#555', marginBottom: '16px' }}>
        ë²„íŠ¼ì„ ë¹ ë¥´ê²Œ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•´ë„ ì§„í–‰ ì¤‘ì¸ ìš”ì²­ì´ ì™„ë£Œë˜ê¸° ì „ê¹Œì§€ í•œ ë²ˆë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
      </p>

      <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '16px' }}>
        <button
          onClick={() => {
            setClickCount((c) => c + 1);
            handleClick(fetchCount + 1);
          }}
          disabled={isLoading}
          style={{
            padding: '8px 20px',
            backgroundColor: isLoading ? '#9ca3af' : '#6366f1',
            color: '#fff',
            border: 'none',
            borderRadius: '6px',
            cursor: isLoading ? 'not-allowed' : 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            transition: 'background-color 0.2s',
          }}
        >
          {isLoading ? 'ë¡œë”© ì¤‘...' : `Todo #${fetchCount + 1} ë¶ˆëŸ¬ì˜¤ê¸°`}
        </button>
        {isLoading && (
          <span style={{ fontSize: '13px', color: '#6366f1' }}>â³ ìš”ì²­ ì§„í–‰ ì¤‘</span>
        )}
      </div>

      <div
        style={{
          display: 'grid',
          gridTemplateColumns: '1fr 1fr',
          gap: '12px',
          marginBottom: '16px',
        }}
      >
        <div
          style={{
            padding: '12px 16px',
            backgroundColor: '#f0f9ff',
            border: '1px solid #bae6fd',
            borderRadius: '8px',
          }}
        >
          <div style={{ fontSize: '12px', color: '#0284c7', marginBottom: '4px' }}>ë²„íŠ¼ í´ë¦­ íšŸìˆ˜</div>
          <div style={{ fontSize: '24px', fontWeight: '700', color: '#0369a1' }}>{clickCount}</div>
        </div>
        <div
          style={{
            padding: '12px 16px',
            backgroundColor: '#f0fdf4',
            border: '1px solid #bbf7d0',
            borderRadius: '8px',
          }}
        >
          <div style={{ fontSize: '12px', color: '#16a34a', marginBottom: '4px' }}>ì‹¤ì œ API í˜¸ì¶œ íšŸìˆ˜</div>
          <div style={{ fontSize: '24px', fontWeight: '700', color: '#15803d' }}>{fetchCount}</div>
        </div>
      </div>

      {lastResult && (
        <div
          style={{
            padding: '12px 16px',
            backgroundColor: '#fafafa',
            border: '1px solid #e5e7eb',
            borderRadius: '8px',
            fontSize: '14px',
          }}
        >
          <strong>ë§ˆì§€ë§‰ ì‘ë‹µ:</strong> {lastResult}
        </div>
      )}

      {isError && (
        <div
          style={{
            marginTop: '12px',
            padding: '12px 16px',
            backgroundColor: '#fef2f2',
            border: '1px solid #fecaca',
            borderRadius: '8px',
            color: '#dc2626',
            fontSize: '14px',
          }}
        >
          ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
        </div>
      )}
    </div>
  );
};

<Example1 />

<br />

### Example2 (isError ì²˜ë¦¬ ì˜ˆì œ)

ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ `isError`ê°€ `true`ë¡œ ë³€ê²½ë˜ê³ , ë‹¤ìŒ ì •ìƒ í˜¸ì¶œ ì‹œ `false`ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

export const Example2 = () => {
  const [log, setLog] = useState([]);
  const { isLoading, isError, blockMultipleAsyncCalls } = useBlockMultipleAsyncCalls();

  const addLog = (msg, type = 'info') => {
    setLog((prev) => [...prev, { msg, type }]);
  };

  const successFetch = async () => {
    addLog('ì •ìƒ ìš”ì²­ ì‹œì‘...', 'info');
    await new Promise((resolve) => setTimeout(resolve, 1000));
    addLog('ì •ìƒ ìš”ì²­ ì™„ë£Œ âœ…', 'success');
  };

  const errorFetch = async () => {
    addLog('ì—ëŸ¬ ìš”ì²­ ì‹œì‘...', 'info');
    await new Promise((_, reject) => setTimeout(() => reject(new Error('ì„œë²„ ì—ëŸ¬ ë°œìƒ')), 800));
  };

  const handleSuccess = blockMultipleAsyncCalls(successFetch);
  const handleError = blockMultipleAsyncCalls(errorFetch);

  return (
    <div style={{ fontFamily: 'sans-serif' }}>
      <div style={{ display: 'flex', gap: '10px', marginBottom: '16px', flexWrap: 'wrap' }}>
        <button
          onClick={handleSuccess}
          style={{
            padding: '8px 16px',
            backgroundColor: '#2563eb', // ë³´ê¸° ì¢‹ì€ blue ê³„ì—´ (blue-600)
            color: '#fff',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
          }}
        >
          ì§€ì† ìš”ì²­
        </button>
        <button
          onClick={handleSuccess}
          disabled={isLoading}
          style={{
            padding: '8px 16px',
            backgroundColor: isLoading ? '#9ca3af' : '#16a34a',
            color: '#fff',
            border: 'none',
            borderRadius: '6px',
            cursor: isLoading ? 'not-allowed' : 'pointer',
            fontSize: '14px',
            fontWeight: '600',
          }}
        >
          ì •ìƒ ìš”ì²­
        </button>
        <button
          onClick={() => {
            handleError().catch(() => addLog('ì—ëŸ¬ catchë¨ âŒ', 'error'));
          }}
          disabled={isLoading}
          style={{
            padding: '8px 16px',
            backgroundColor: isLoading ? '#9ca3af' : '#dc2626',
            color: '#fff',
            border: 'none',
            borderRadius: '6px',
            cursor: isLoading ? 'not-allowed' : 'pointer',
            fontSize: '14px',
            fontWeight: '600',
          }}
        >
          ì—ëŸ¬ ìš”ì²­
        </button>
      </div>

      <div style={{ display: 'flex', gap: '10px', marginBottom: '16px' }}>
        <div
          style={{
            padding: '8px 14px',
            borderRadius: '6px',
            fontSize: '13px',
            fontWeight: '600',
            backgroundColor: isLoading ? '#eff6ff' : '#f3f4f6',
            color: isLoading ? '#2563eb' : '#6b7280',
            border: `1px solid ${isLoading ? '#bfdbfe' : '#e5e7eb'}`,
          }}
        >
          isLoading: {String(isLoading)}
        </div>
        <div
          style={{
            padding: '8px 14px',
            borderRadius: '6px',
            fontSize: '13px',
            fontWeight: '600',
            backgroundColor: isError ? '#fef2f2' : '#f3f4f6',
            color: isError ? '#dc2626' : '#6b7280',
            border: `1px solid ${isError ? '#fecaca' : '#e5e7eb'}`,
          }}
        >
          isError: {String(isError)}
        </div>
      </div>

      <div
        style={{
          minHeight: '100px',
          maxHeight: '160px',
          overflowY: 'auto',
          border: '1px solid #e5e7eb',
          borderRadius: '8px',
          padding: '12px 16px',
          backgroundColor: '#f9fafb',
        }}
      >
        {log.length === 0 ? (
          <p style={{ color: '#9ca3af', fontSize: '13px', margin: 0 }}>
            ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë¡œê·¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.
          </p>
        ) : (
          log.map((entry, i) => (
            <div
              key={i}
              style={{
                fontSize: '13px',
                color: entry.type === 'success' ? '#16a34a' : entry.type === 'error' ? '#dc2626' : '#374151',
                padding: '2px 0',
                fontFamily: 'monospace',
              }}
            >
              {entry.msg}
            </div>
          ))
        )}
      </div>

      {log.length > 0 && (
        <button
          onClick={() => setLog([])}
          style={{
            marginTop: '8px',
            padding: '4px 12px',
            fontSize: '12px',
            color: '#6b7280',
            backgroundColor: 'transparent',
            border: '1px solid #d1d5db',
            borderRadius: '4px',
            cursor: 'pointer',
          }}
        >
          ë¡œê·¸ ì´ˆê¸°í™”
        </button>
      )}
    </div>
  );
};

<Example2 />
