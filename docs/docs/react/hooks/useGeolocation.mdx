import { useGeolocation } from '@modern-kit/react';
import { useState } from 'react';

# useGeolocation

ë¸Œë¼ìš°ì €ì˜ Geolocation APIë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì»¤ìŠ¤í…€ í›…ì…ë‹ˆë‹¤.

ìœ„ì¹˜ ì •ë³´ë¥¼ í•œ ë²ˆë§Œ ê°€ì ¸ì˜¤ê±°ë‚˜(`get`), ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì (`watch`)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />

## Code
[ğŸ”— ì‹¤ì œ êµ¬í˜„ ì½”ë“œ í™•ì¸](https://github.com/modern-agile-team/modern-kit/blob/main/packages/react/src/hooks/useGeolocation/index.ts)

<br />

## Interface
```ts title="typescript"
interface UseGeolocationOptions extends PositionOptions {
  mountBehavior?: 'watch' | 'get';
}

interface UseGeolocationReturn {
  data: GeolocationData | null;
  error: GeolocationPositionError | Error | null;
  loading: boolean;
  isWatching: boolean;
  get: () => void;
  watch: () => void;
  stopWatch: () => void;
}

type GeolocationData = GeolocationPosition['coords'] & { timestamp: number };

function useGeolocation(options?: UseGeolocationOptions): UseGeolocationReturn;
```

<br />

### Options

| Name | Type | Default | Description |
|------|------|---------|-------------|
| `enableHighAccuracy` | `boolean` | `false` | ë†’ì€ ì •í™•ë„ì˜ ìœ„ì¹˜ ì •ë³´ë¥¼ ìš”ì²­í• ì§€ ì—¬ë¶€ (GPS ì‚¬ìš©, ë°°í„°ë¦¬ ì†Œëª¨ ì¦ê°€) |
| `timeout` | `number` | `Infinity` | ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° í—ˆìš©ë˜ëŠ” ìµœëŒ€ ì‹œê°„ (ë°€ë¦¬ì´ˆ) |
| `maximumAge` | `number` | `0` | ìºì‹œëœ ìœ„ì¹˜ ì •ë³´ì˜ ìµœëŒ€ ìˆ˜ëª… (ë°€ë¦¬ì´ˆ) |
| `mountBehavior` | `'watch' \| 'get'` | `'get'` | í›…ì´ ë§ˆìš´íŠ¸ë  ë•Œ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ |

<br />

### Returns

| Name | Type | Description |
|------|------|-------------|
| `data` | `GeolocationData \| null` | ìœ„ì¹˜ ì •ë³´ ë°ì´í„° (ìœ„ë„, ê²½ë„, ì •í™•ë„, ê³ ë„, íƒ€ì„ìŠ¤íƒ¬í”„ ë“±) |
| `error` | `GeolocationPositionError \| Error \| null` | ì—ëŸ¬ ì •ë³´ |
| `loading` | `boolean` | ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì¸ì§€ ì—¬ë¶€ |
| `isWatching` | `boolean` | í˜„ì¬ ìœ„ì¹˜ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì  ì¤‘ì¸ì§€ ì—¬ë¶€ |
| `get` | `() => void` | í˜„ì¬ ìœ„ì¹˜ë¥¼ í•œ ë²ˆ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ |
| `watch` | `() => void` | ìœ„ì¹˜ ë³€í™”ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•˜ê¸° ì‹œì‘í•˜ëŠ” í•¨ìˆ˜ |
| `stopWatch` | `() => void` | ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì ì„ ì¤‘ì§€í•˜ëŠ” í•¨ìˆ˜ |

<br />

### GeolocationData

| Name | Type | Description |
|------|------|-------------|
| `latitude` | `number` | ìœ„ë„ |
| `longitude` | `number` | ê²½ë„ |
| `accuracy` | `number` | ìœ„ì¹˜ ì •í™•ë„ (ë¯¸í„°) |
| `altitude` | `number \| null` | ê³ ë„ (ë¯¸í„°) |
| `altitudeAccuracy` | `number \| null` | ê³ ë„ ì •í™•ë„ (ë¯¸í„°) |
| `heading` | `number \| null` | ì´ë™ ë°©í–¥ (0Â°~360Â°, ë¶ìª½ ê¸°ì¤€) |
| `speed` | `number \| null` | ì´ë™ ì†ë„ (m/s) |
| `timestamp` | `number` | ìœ„ì¹˜ ì •ë³´ê°€ íšë“ëœ ì‹œê°„ |

<br />

## Remarks

:::caution ì£¼ì˜ì‚¬í•­
- **HTTPS í•„ìˆ˜**: Geolocation APIëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ `HTTPS` í™˜ê²½ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤. (`localhost`ëŠ” ì˜ˆì™¸)
- **ì‚¬ìš©ì ê¶Œí•œ í•„ìš”**: ìœ„ì¹˜ ì •ë³´ì— ì ‘ê·¼í•˜ê¸° ì „ì— ë¸Œë¼ìš°ì €ì—ì„œ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œ ìš”ì²­ íŒì—…ì´ í‘œì‹œë©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ê±°ë¶€í•˜ë©´ ì—ëŸ¬ê°€ ë°˜í™˜ë©ë‹ˆë‹¤.
- **SSR í™˜ê²½**: ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ í™˜ê²½ì—ì„œëŠ” `navigator.geolocation`ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í›… ë‚´ë¶€ì—ì„œ ì´ë¥¼ ê°ì§€í•˜ì—¬ ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- **ë°°í„°ë¦¬ ì†Œëª¨**: `enableHighAccuracy: true` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ GPSë¥¼ í™œìš©í•˜ì—¬ ë” ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì œê³µí•˜ì§€ë§Œ, ë°°í„°ë¦¬ ì†Œëª¨ê°€ ì¦ê°€í•©ë‹ˆë‹¤.
- **watch ëª¨ë“œ**: ì‹¤ì‹œê°„ ì¶”ì (`watch`) ëª¨ë“œ ì‚¬ìš© ì‹œ ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ìë™ìœ¼ë¡œ ì¶”ì ì´ ì¤‘ì§€ë©ë‹ˆë‹¤.
:::

<br />

:::tip ì—ëŸ¬ í•¸ë“¤ë§
Geolocation APIì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì£¼ìš” ì—ëŸ¬:
- `PERMISSION_DENIED` (code: 1): ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì„ ê±°ë¶€í•¨
- `POSITION_UNAVAILABLE` (code: 2): ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- `TIMEOUT` (code: 3): ì§€ì •ëœ ì‹œê°„ ë‚´ì— ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•¨
:::

<br />

## Usage

### ê¸°ë³¸ ì‚¬ìš©ë²• (í•œ ë²ˆë§Œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°)

```tsx title="typescript"
import { useGeolocation } from '@modern-kit/react';

const LocationComponent = () => {
  const { data, error, loading } = useGeolocation();

  if (loading) return <div>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬: {error.message}</div>;
  if (!data) return null;

  return (
    <div>
      <p>ìœ„ë„: {data.latitude}</p>
      <p>ê²½ë„: {data.longitude}</p>
      <p>ì •í™•ë„: {data.accuracy}m</p>
    </div>
  );
};
```

<br />

### ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì 

```tsx title="typescript"
import { useGeolocation } from '@modern-kit/react';

const RealTimeLocation = () => {
  const { data, isWatching, watch, stopWatch } = useGeolocation({ 
    mountBehavior: 'watch',
    enableHighAccuracy: true 
  });

  return (
    <div>
      <p>ì¶”ì  ìƒíƒœ: {isWatching ? 'ì¶”ì  ì¤‘' : 'ì¤‘ì§€'}</p>
      {data && (
        <>
          <p>ìœ„ë„: {data.latitude}</p>
          <p>ê²½ë„: {data.longitude}</p>
        </>
      )}
      <button onClick={isWatching ? stopWatch : watch}>
        {isWatching ? 'ì¶”ì  ì¤‘ì§€' : 'ì¶”ì  ì‹œì‘'}
      </button>
    </div>
  );
};
```

<br />

### ìˆ˜ë™ìœ¼ë¡œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°

```tsx title="typescript"
import { useGeolocation } from '@modern-kit/react';

const ManualLocation = () => {
  // mountBehaviorë¥¼ undefinedë¡œ ì„¤ì •í•˜ë©´ ë§ˆìš´íŠ¸ ì‹œ ìë™ìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ì§€ ì•ŠìŒ
  const { data, loading, get } = useGeolocation({ 
    mountBehavior: undefined 
  });

  return (
    <div>
      <button onClick={get} disabled={loading}>
        {loading ? 'ë¡œë”© ì¤‘...' : 'í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°'}
      </button>
      {data && (
        <p>ìœ„ë„: {data.latitude}, ê²½ë„: {data.longitude}</p>
      )}
    </div>
  );
};
```

<br />

### íƒ€ì„ì•„ì›ƒê³¼ ë†’ì€ ì •í™•ë„ ì˜µì…˜ ì„¤ì •

```tsx title="typescript"
import { useGeolocation } from '@modern-kit/react';

const PreciseLocation = () => {
  const { data, error } = useGeolocation({
    enableHighAccuracy: true,  // GPS ì‚¬ìš©
    timeout: 10000,            // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
    maximumAge: 60000,         // 1ë¶„ê°„ ìºì‹œëœ ìœ„ì¹˜ ì‚¬ìš© í—ˆìš©
  });

  if (error) {
    return <div>ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {error.message}</div>;
  }

  return data ? (
    <div>ì •í™•í•œ ìœ„ì¹˜: {data.latitude}, {data.longitude}</div>
  ) : null;
};
```

<br />

## Example

export const Example = () => {
  const { data, error, loading, isWatching, get, watch, stopWatch } = useGeolocation({
    enableHighAccuracy: true,
    timeout: 10000,
  });

  const formatCoord = (num) => num?.toFixed(6) ?? '-';
  const formatAccuracy = (num) => num?.toFixed(1) ?? '-';
  const formatTimestamp = (ts) => ts ? new Date(ts).toLocaleTimeString('ko-KR') : '-';

  return (
    <div>
      <div style={{ marginBottom: '20px' }}>
        <h4 style={{ margin: '0 0 10px 0' }}>ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•</h4>
        <ol style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6' }}>
          <li>ë¸Œë¼ìš°ì €ì—ì„œ <strong>ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì„ í—ˆìš©</strong>í•˜ì„¸ìš”</li>
          <li><strong>'í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°'</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”</li>
          <li><strong>'ì‹¤ì‹œê°„ ì¶”ì  ì‹œì‘'</strong> ë²„íŠ¼ìœ¼ë¡œ ìœ„ì¹˜ ë³€í™”ë¥¼ ì¶”ì í•´ ë³´ì„¸ìš”</li>
        </ol>
      </div>

      {/* ìƒíƒœ í‘œì‹œ */}
      <div style={{
        display: 'flex',
        gap: '10px',
        marginBottom: '15px',
        flexWrap: 'wrap'
      }}>
        <span style={{
          padding: '4px 12px',
          borderRadius: '20px',
          fontSize: '13px',
          fontWeight: '500',
          backgroundColor: loading ? '#fef3c7' : '#e5e7eb',
          color: loading ? '#d97706' : '#6b7280'
        }}>
          {loading ? 'â³ ë¡œë”© ì¤‘...' : 'âœ“ ëŒ€ê¸° ì¤‘'}
        </span>
        <span style={{
          padding: '4px 12px',
          borderRadius: '20px',
          fontSize: '13px',
          fontWeight: '500',
          backgroundColor: isWatching ? '#dcfce7' : '#e5e7eb',
          color: isWatching ? '#16a34a' : '#6b7280'
        }}>
          {isWatching ? 'ğŸ“¡ ì‹¤ì‹œê°„ ì¶”ì  ì¤‘' : 'â¸ ì¶”ì  ì¤‘ì§€'}
        </span>
      </div>

      {/* ë²„íŠ¼ ê·¸ë£¹ */}
      <div style={{ 
        display: 'flex', 
        gap: '10px', 
        marginBottom: '20px',
        flexWrap: 'wrap'
      }}>
        <button 
          onClick={get}
          disabled={loading}
          style={{
            padding: '10px 20px',
            borderRadius: '8px',
            border: 'none',
            backgroundColor: '#3b82f6',
            color: 'white',
            fontWeight: '500',
            cursor: loading ? 'not-allowed' : 'pointer',
            opacity: loading ? 0.6 : 1
          }}
        >
          ğŸ“ í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        </button>
        <button 
          onClick={isWatching ? stopWatch : watch}
          style={{
            padding: '10px 20px',
            borderRadius: '8px',
            border: 'none',
            backgroundColor: isWatching ? '#ef4444' : '#22c55e',
            color: 'white',
            fontWeight: '500',
            cursor: 'pointer'
          }}
        >
          {isWatching ? 'â¹ ì¶”ì  ì¤‘ì§€' : 'â–¶ï¸ ì‹¤ì‹œê°„ ì¶”ì  ì‹œì‘'}
        </button>
      </div>

      {/* ì—ëŸ¬ í‘œì‹œ */}
      {error && (
        <div style={{
          padding: '15px',
          backgroundColor: '#fef2f2',
          border: '1px solid #fecaca',
          borderRadius: '8px',
          marginBottom: '15px',
          color: '#dc2626'
        }}>
          <strong>âŒ ì—ëŸ¬:</strong> {error.message}
        </div>
      )}

      {/* ìœ„ì¹˜ ì •ë³´ í‘œì‹œ */}
      {data && (
        <div style={{
          border: '2px solid #3b82f6',
          borderRadius: '12px',
          padding: '20px',
          backgroundColor: '#f8fafc'
        }}>
          <h4 style={{ margin: '0 0 15px 0', color: '#1e40af' }}>ğŸ“ ìœ„ì¹˜ ì •ë³´</h4>
          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
            gap: '12px'
          }}>
            <div style={{
              padding: '12px',
              backgroundColor: 'white',
              borderRadius: '8px',
              boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
            }}>
              <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>ìœ„ë„ (Latitude)</div>
              <div style={{ fontSize: '18px', fontWeight: '600', color: '#1f2937' }}>{formatCoord(data.latitude)}</div>
            </div>
            <div style={{
              padding: '12px',
              backgroundColor: 'white',
              borderRadius: '8px',
              boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
            }}>
              <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>ê²½ë„ (Longitude)</div>
              <div style={{ fontSize: '18px', fontWeight: '600', color: '#1f2937' }}>{formatCoord(data.longitude)}</div>
            </div>
            <div style={{
              padding: '12px',
              backgroundColor: 'white',
              borderRadius: '8px',
              boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
            }}>
              <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>ì •í™•ë„ (Accuracy)</div>
              <div style={{ fontSize: '18px', fontWeight: '600', color: '#1f2937' }}>{formatAccuracy(data.accuracy)}m</div>
            </div>
            <div style={{
              padding: '12px',
              backgroundColor: 'white',
              borderRadius: '8px',
              boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
            }}>
              <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>íƒ€ì„ìŠ¤íƒ¬í”„</div>
              <div style={{ fontSize: '18px', fontWeight: '600', color: '#1f2937' }}>{formatTimestamp(data.timestamp)}</div>
            </div>
          </div>

          {/* ê³ ë„ ì •ë³´ (ìˆëŠ” ê²½ìš°) */}
          {data.altitude != null && (
            <div style={{ marginTop: '15px', padding: '12px', backgroundColor: '#f0f9ff', borderRadius: '8px' }}>
              <div style={{ fontSize: '12px', color: '#0369a1', marginBottom: '4px' }}>ê³ ë„ (Altitude)</div>
              <div style={{ fontSize: '16px', fontWeight: '600', color: '#0c4a6e' }}>
                {data.altitude.toFixed(1)}m (ì •í™•ë„: {data.altitudeAccuracy?.toFixed(1) ?? '-'}m)
              </div>
            </div>
          )}
        </div>
      )}

      {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
      <div style={{ 
        marginTop: '20px', 
        padding: '12px', 
        backgroundColor: '#f0f9ff', 
        borderLeft: '3px solid #3b82f6',
        borderRadius: '4px',
        fontSize: '14px'
      }}>
        <strong>ğŸ’¡ ì°¸ê³ :</strong> ìœ„ì¹˜ ì •ë³´ëŠ” ë¸Œë¼ìš°ì €ì™€ ê¸°ê¸°ì— ë”°ë¼ ì •í™•ë„ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
        <code style={{ backgroundColor: '#e0e7ff', padding: '2px 6px', borderRadius: '4px', margin: '0 4px' }}>enableHighAccuracy: true</code> 
        ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ GPSë¥¼ í™œìš©í•˜ì—¬ ë” ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    </div>
  );
};

<Example />
