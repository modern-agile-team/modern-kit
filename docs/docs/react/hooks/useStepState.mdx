import { useStepState } from '@modern-kit/react';
import { useState } from 'react';

# useStepState

**[useStep](https://modern-agile-team.github.io/modern-kit/docs/react/hooks/useStep)** ì„ í™•ì¥í•´ `multi-step process`ì˜ `step`ì„ ê´€ë¦¬ ë° ì¶”ì í•˜ë©° ë™ì‹œì— `ë‚´ë¶€ ìƒíƒœ`ë¥¼ ê´€ë¦¬ í•  ìˆ˜ ìˆëŠ” ì»¤ìŠ¤í…€ í›…ì…ë‹ˆë‹¤.

`storageOptions`ë¥¼ í™œìš©í•´ `setState` ì‹œì— ë¸Œë¼ìš°ì € ìŠ¤í† ë¦¬ì§€(`sessionStorage`, `localStorage`)ì— ìƒíƒœë¥¼ ì €ì¥ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`clearState`ëŠ” stateë¥¼ `null`ë¡œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. `storageOptions`ê°€ ìˆì„ ê²½ìš° í•´ë‹¹ `options`ì— ëŒ€ì‘í•˜ëŠ” ìŠ¤í† ë¦¬ì§€ ë°ì´í„°ë¥¼ ì œê±°í•©ë‹ˆë‹¤.

<br />

## Code
[ğŸ”— ì‹¤ì œ êµ¬í˜„ ì½”ë“œ í™•ì¸](https://github.com/modern-agile-team/modern-kit/blob/main/packages/react/src/hooks/useStepState/index.ts)

## Interface
```ts title="typescript"
interface StorageOptions {
  key: string;
  type: 'localStorage' | 'sessionStorage';
}

interface UseStepWithInitialState<T> extends UseStepProps {
  initialState: T;
  storageOptions?: StorageOptions;
}

interface UseStepWithoutInitialState extends UseStepProps {
  storageOptions?: StorageOptions;
}
```
```ts title="typescript"
// í•¨ìˆ˜ ì˜¤ë²„ë¡œë”©
export function useStepState<T>({
  initialState,
  ...props
}: UseStepWithInitialState<T>): ReturnType<typeof useStep> & {
  readonly state: T;
  readonly setState: (newState: SetStateAction<T>) => void;
  readonly clearState: () => void;
};

export function useStepState<T>(props: UseStepWithoutInitialState): ReturnType<
  typeof useStep
> & {
  readonly state: T | null;
  readonly setState: (newState: SetStateAction<T | null>) => void;
  readonly clearState: () => void;
};
```

## Usage
```tsx title="typescript"
import { useStepState } from '@modern-kit/react';

export const Example = () => {
  const { state, setState, clearState, currentStep, goToNextStep, goToPrevStep } =
    useStepState({
      maxStep: 2,
      initialState: { name: '' },
      storageOptions: { key: 'stepState', type: 'sessionStorage' },
    });

  const handleGoToNextStep = () => {
    goToNextStep(({ prevStep, nextStep }) => {
      console.log(`${prevStep}ì—ì„œ ${nextStep}ë¡œ ì´ë™`);
      setState({ name: 'bar' });
    });
  };

  const handleGoToPrevStep = () => {
    goToPrevStep(({ prevStep, nextStep }) => {
      console.log(`${prevStep}ì—ì„œ ${nextStep}ë¡œ ì´ë™`);
      setState({ name: 'foo' });
    });
  };

  const boxStyle = {
    width: '300px',
    height: '120px',
    fontSize: '21px',
  };

  return (
    <div>
      <div>
        <button onClick={handleGoToPrevStep}>ì´ì „ ìŠ¤íƒ­</button>
        <button onClick={handleGoToNextStep}>ë‹¤ìŒ ìŠ¤íƒ­</button>
        <button onClick={clearState}>ìƒíƒœ ì´ˆê¸°í™”</button>
      </div>
      <div>
        <p>currentStep: {currentStep}</p>
        <p>state: {JSON.stringify(state)}</p>
      </div>
      <div>
        {currentStep === 1 && (
          <div style={{ ...boxStyle, backgroundColor: 'red' }}>
            1ë²ˆ Step Box
          </div>
        )}
        {currentStep === 2 && (
          <div style={{ ...boxStyle, backgroundColor: 'green' }}>
            2ë²ˆ Step Box
          </div>
        )}
      </div>
    </div>
  );
};
```

## Example

export const Example = () => {
  const { state, setState, clearState, currentStep, goToNextStep, goToPrevStep } =
    useStepState({
      maxStep: 2,
      initialState: { name: '' },
      storageOptions: { key: 'stepState', type: 'sessionStorage' },
    });

  const handleGoToNextStep = () => {
    goToNextStep(({ prevStep, nextStep }) => {
      console.log(`${prevStep}ì—ì„œ ${nextStep}ë¡œ ì´ë™`);
      setState({ name: 'bar' });
    });
  };

  const handleGoToPrevStep = () => {
    goToPrevStep(({ prevStep, nextStep }) => {
      console.log(`${prevStep}ì—ì„œ ${nextStep}ë¡œ ì´ë™`);
      setState({ name: 'foo' });
    });
  };

  const boxStyle = {
    width: '300px',
    height: '120px',
    fontSize: '21px',
  };

  return (
    <div>
      <div>
        <button onClick={handleGoToPrevStep}>ì´ì „ ìŠ¤íƒ­</button>
        <button onClick={handleGoToNextStep}>ë‹¤ìŒ ìŠ¤íƒ­</button>
        <button onClick={clearState}>ìƒíƒœ ì´ˆê¸°í™”</button>
      </div>
      <div>
        <p>currentStep: {currentStep}</p>
        <p>state: {JSON.stringify(state)}</p>
      </div>
      <div>
        {currentStep === 1 && (
          <div style={{ ...boxStyle, backgroundColor: 'red' }}>
            1ë²ˆ Step Box
          </div>
        )}
        {currentStep === 2 && (
          <div style={{ ...boxStyle, backgroundColor: 'green' }}>
            2ë²ˆ Step Box
          </div>
        )}
      </div>
    </div>
  );
};

<Example />

<br />

## Best Practice
- ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ ì‹œ ìƒíƒœë¥¼ ì ì ˆí•˜ê²Œ ìœ ì§€í•˜ê³  ì‹¶ë‹¤ë©´ `queryString`ê³¼ `react-router-dom`ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

```tsx
import { useStepState } from '@modern-kit/react';
import { useNavigate } from 'react-router-dom'
import qs from 'query-string'

const Example = () => {
  const parsedStorage = JSON.parse(sessionStorage.getItem('stepState'));
  const parsedQuery = qs.parse(location.search);

  const navigate = useNavigate();

  const { state, setState, goToNextStep, goToPrevStep } = useStepState({
    maxStep: 5,
    initialState: parsedStorage,
    initialStep: parsedQuery.step,
    storageOptions: { key: 'stepState', type: 'sessionStorage' },
  });

  const handleGoToNextStep = () => {
    goToNextStep(({ nextStep }) => {
      setState({
        /* ... */
      });
      navigate(`/test?step=${nextStep}`);
    });
  };

  const handleGoToPrevStep = () => {
    goToNextStep(({ nextStep }) => {
      setState({
        /* ... */
      });
      navigate(`/test?step=${nextStep}`);
    });
  };

  // ...
  return (
    // ...
  );
};
```